---
phase: 31-frontend-create-edit-forms
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/entity/forms/schemas.ts
  - frontend/src/components/entity/forms/DashboardForm.tsx
autonomous: true

must_haves:
  truths:
    - "DashboardForm renders with ID, label, description fields"
    - "DashboardForm shows accordion for page management"
    - "Users can add/remove pages in DashboardForm"
    - "Users can edit wikitext for each page"
    - "Root page auto-created with empty name on form init"
  artifacts:
    - path: "frontend/src/components/entity/forms/schemas.ts"
      provides: "dashboardSchema, DashboardFormData type"
      contains: "dashboardSchema"
    - path: "frontend/src/components/entity/forms/DashboardForm.tsx"
      provides: "DashboardForm component"
      exports: ["DashboardForm"]
      min_lines: 100
  key_links:
    - from: "frontend/src/components/entity/forms/DashboardForm.tsx"
      to: "frontend/src/components/entity/forms/schemas.ts"
      via: "import dashboardSchema"
      pattern: "import.*dashboardSchema.*from.*schemas"
    - from: "frontend/src/components/entity/forms/DashboardForm.tsx"
      to: "react-hook-form"
      via: "useForm hook"
      pattern: "useForm<DashboardFormData>"
---

<objective>
Add Zod validation schema for Dashboard entity and create DashboardForm component with page management.

Purpose: Enable dashboard creation in the draft system with proper validation and wikitext editing for each page.
Output: DashboardForm.tsx with accordion-based page management matching DashboardDetail view pattern.
</objective>

<execution_context>
@/home/daharoni/.claude/get-shit-done/workflows/execute-plan.md
@/home/daharoni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-frontend-create-edit-forms/31-CONTEXT.md
@.planning/phases/31-frontend-create-edit-forms/31-RESEARCH.md

# Reference patterns
@frontend/src/components/entity/forms/schemas.ts
@frontend/src/components/entity/forms/CategoryForm.tsx
@frontend/src/components/entity/detail/DashboardDetail.tsx
@frontend/src/api/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dashboard schema to schemas.ts</name>
  <files>frontend/src/components/entity/forms/schemas.ts</files>
  <action>
Add dashboard page schema and dashboard form schema to schemas.ts:

1. Create dashboardPageSchema:
   ```typescript
   const dashboardPageSchema = z.object({
     name: z.string(), // Empty string for root page
     wikitext: z.string(),
   })
   ```

2. Create dashboardSchema:
   ```typescript
   export const dashboardSchema = z.object({
     id: genericIdValidation,
     label: z.string().min(1, 'Label is required'),
     description: z.string().min(1, 'Description is required'),
     pages: z.array(dashboardPageSchema).min(1, 'At least one page is required'),
   })

   export type DashboardFormData = z.infer<typeof dashboardSchema>
   ```

Follow existing schema patterns in the file. Use genericIdValidation (same as Category, Module, etc.) for the ID field per RESEARCH.md.
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>dashboardSchema exported from schemas.ts, DashboardFormData type available</done>
</task>

<task type="auto">
  <name>Task 2: Create DashboardForm component</name>
  <files>frontend/src/components/entity/forms/DashboardForm.tsx</files>
  <action>
Create DashboardForm.tsx following CategoryForm.tsx structure:

1. Interface:
   ```typescript
   interface DashboardFormProps {
     onSubmit: (data: DashboardFormData) => void
     onCancel: () => void
     isSubmitting?: boolean
     draftId?: string
     initialData?: Partial<DashboardFormData>
   }
   ```

2. Form setup with react-hook-form:
   - Use zodResolver(dashboardSchema)
   - mode: 'onBlur' per existing pattern
   - Default values: id='', label='', description='', pages=[{name: '', wikitext: ''}]
   - Root page auto-created on init (empty name string = root)

3. Standard fields using FormField component:
   - ID field (required, placeholder "My_dashboard")
   - Label field (required)
   - Description field (required, Textarea)

4. Pages section with Accordion (matching DashboardDetail pattern):
   - Use Accordion from @/components/ui/accordion
   - type="single" collapsible for one-page-at-a-time expansion
   - Each page as AccordionItem with:
     - AccordionTrigger showing page name or "(Root Page)" for empty name
     - AccordionContent with Textarea for wikitext editing
   - Page name input field (except root page index 0)
   - Delete button for non-root pages (index > 0)

5. Add Page button:
   - Adds new page with auto-generated name: `page-${pages.length}`
   - Empty wikitext

6. Page array manipulation using form.getValues('pages') and form.setValue('pages', [...]):
   - Add: append to array
   - Remove: filter from array
   - Edit: update specific index

7. Submit/Cancel buttons (same pattern as CategoryForm)

Import icons from lucide-react: Plus, Trash2
  </action>
  <verify>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Manual check: Verify file exports DashboardForm function
  </verify>
  <done>DashboardForm component with page management accordion, auto-creates root page, supports add/remove pages</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. schemas.ts exports dashboardSchema and DashboardFormData
3. DashboardForm.tsx exports DashboardForm component
4. DashboardForm initializes with root page (empty name)
5. No eslint errors blocking build
</verification>

<success_criteria>
- dashboardSchema validates: id (generic pattern), label (required), description (required), pages (min 1)
- DashboardFormData type is exported and usable
- DashboardForm renders ID, Label, Description fields
- DashboardForm shows accordion with pages
- Add Page button works
- Delete page button works (for non-root pages)
- Wikitext editing works for each page
</success_criteria>

<output>
After completion, create `.planning/phases/31-frontend-create-edit-forms/31-01-SUMMARY.md`
</output>

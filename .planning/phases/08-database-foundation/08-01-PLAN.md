---
phase: 08-database-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/app/models/v2/__init__.py
  - backend/app/models/v2/ontology_version.py
  - backend/app/models/v2/category.py
  - backend/app/models/v2/property.py
  - backend/app/models/v2/subobject.py
  - backend/app/models/v2/module.py
  - backend/app/models/v2/bundle.py
  - backend/app/models/v2/template.py
  - backend/app/models/v2/enums.py
autonomous: true

must_haves:
  truths:
    - "ontology_version table can track current canonical commit SHA and ingest status"
    - "Each of the 6 entity types has its own table with entity_key, source_path, and canonical_json"
    - "Entity tables use UUIDs as primary keys with proper indexing on entity_key"
  artifacts:
    - path: "backend/app/models/v2/ontology_version.py"
      provides: "OntologyVersion model with commit_sha, ingest_status, ingested_at"
      exports: ["OntologyVersion", "IngestStatus"]
    - path: "backend/app/models/v2/category.py"
      provides: "Category entity model"
      exports: ["Category", "CategoryBase", "CategoryPublic"]
    - path: "backend/app/models/v2/property.py"
      provides: "Property entity model"
      exports: ["Property", "PropertyBase", "PropertyPublic"]
    - path: "backend/app/models/v2/subobject.py"
      provides: "Subobject entity model"
      exports: ["Subobject", "SubobjectBase", "SubobjectPublic"]
    - path: "backend/app/models/v2/module.py"
      provides: "Module entity model with version field"
      exports: ["Module", "ModuleBase", "ModulePublic"]
    - path: "backend/app/models/v2/bundle.py"
      provides: "Bundle entity model with version field"
      exports: ["Bundle", "BundleBase", "BundlePublic"]
    - path: "backend/app/models/v2/template.py"
      provides: "Template entity model for wikitext templates"
      exports: ["Template", "TemplateBase", "TemplatePublic"]
    - path: "backend/app/models/v2/enums.py"
      provides: "Shared enums for v2.0 models"
      exports: ["IngestStatus", "EntityType"]
  key_links:
    - from: "backend/app/models/v2/__init__.py"
      to: "all entity models"
      via: "re-exports all models for single import point"
      pattern: "from app\\.models\\.v2 import"
---

<objective>
Create v2.0 entity models: ontology_version tracking table and separate tables for each of the 6 entity types (category, property, subobject, module, bundle, template).

Purpose: Replace v1.0's generic `entities` table with typed tables that support normalized relationships and proper querying. This is the foundation for all v2.0 data storage.

Output: SQLModel classes in `backend/app/models/v2/` ready for relationship tables and migration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-database-foundation/08-CONTEXT.md
@.planning/phases/08-database-foundation/08-RESEARCH.md
@backend/app/models/entity.py
@backend/app/models/module.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create v2 model directory and shared enums</name>
  <files>backend/app/models/v2/__init__.py, backend/app/models/v2/enums.py</files>
  <action>
Create the v2 model directory structure:

1. Create `backend/app/models/v2/enums.py` with shared enums:
   - `IngestStatus(str, Enum)`: pending, in_progress, completed, failed
   - `EntityType(str, Enum)`: category, property, subobject, module, bundle, template (extended from v1.0)

2. Create `backend/app/models/v2/__init__.py` as empty placeholder (will be populated after all models exist)

Follow SQLModel enum pattern from research (use `sa_column=Column(Enum(...))`).
  </action>
  <verify>
```bash
python -c "from backend.app.models.v2.enums import IngestStatus, EntityType; print('Enums OK')"
```
  </verify>
  <done>IngestStatus and EntityType enums importable from backend.app.models.v2.enums</done>
</task>

<task type="auto">
  <name>Task 2: Create ontology_version model</name>
  <files>backend/app/models/v2/ontology_version.py</files>
  <action>
Create OntologyVersion model tracking current canonical state:

```python
class OntologyVersion(SQLModel, table=True):
    __tablename__ = "ontology_version"

    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)
    commit_sha: str = Field(unique=True, index=True)  # Git commit SHA
    ingest_status: IngestStatus = Field(sa_column=Column(Enum(IngestStatus)))
    entity_counts: dict | None = Field(default=None, sa_column=Column(JSON))  # {"category": 10, ...}
    warnings: list | None = Field(default=None, sa_column=Column(JSON))  # Ingest warnings
    errors: list | None = Field(default=None, sa_column=Column(JSON))  # Ingest errors
    ingested_at: datetime | None = None
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

Only ONE row will exist at a time (latest version), but keep as table for flexibility and tracking.
  </action>
  <verify>
```bash
python -c "from backend.app.models.v2.ontology_version import OntologyVersion; print('OntologyVersion OK')"
```
  </verify>
  <done>OntologyVersion model with commit_sha, ingest_status, entity_counts, warnings, errors fields</done>
</task>

<task type="auto">
  <name>Task 3: Create 6 entity type models</name>
  <files>backend/app/models/v2/category.py, backend/app/models/v2/property.py, backend/app/models/v2/subobject.py, backend/app/models/v2/module.py, backend/app/models/v2/bundle.py, backend/app/models/v2/template.py, backend/app/models/v2/__init__.py</files>
  <action>
Create one model file per entity type following this pattern:

**Common structure for each entity:**
```python
class {Entity}Base(SQLModel):
    entity_key: str = Field(index=True)  # Path-derived key, e.g., "Person"
    source_path: str  # Original file path, e.g., "categories/Person.json"
    label: str = Field(index=True)
    description: str | None = None
    canonical_json: dict = Field(default_factory=dict, sa_column=Column(JSON))

class {Entity}({Entity}Base, table=True):
    __tablename__ = "{entity_plural}"
    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)

class {Entity}Public({Entity}Base):
    id: uuid.UUID
    created_at: datetime
    updated_at: datetime
```

**Entity-specific additions:**
- `Module`: Add `version: str | None` field for semver
- `Bundle`: Add `version: str | None` field for semver
- `Template`: Add `wikitext: str | None` field for template content

**Table names:**
- category -> categories
- property -> properties
- subobject -> subobjects
- module -> modules
- bundle -> bundles
- template -> templates

**Update __init__.py** to re-export all models:
```python
from backend.app.models.v2.enums import EntityType, IngestStatus
from backend.app.models.v2.ontology_version import OntologyVersion
from backend.app.models.v2.category import Category, CategoryBase, CategoryPublic
# ... etc for all entities
```

Add unique constraint on entity_key for each entity table.
  </action>
  <verify>
```bash
cd /home/daharoni/dev/ontology-hub && python -c "
from backend.app.models.v2 import (
    Category, Property, Subobject, Module, Bundle, Template,
    OntologyVersion, EntityType, IngestStatus
)
print('All v2 models importable')
print(f'Category table: {Category.__tablename__}')
print(f'Module has version: {hasattr(Module, \"version\")}')
"
```
  </verify>
  <done>All 6 entity models with entity_key, source_path, canonical_json; Module and Bundle have version field; all re-exported from __init__.py</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Import check:**
```bash
cd /home/daharoni/dev/ontology-hub && python -c "
from backend.app.models.v2 import *
print('All imports successful')
"
```

2. **Model structure check:**
```bash
cd /home/daharoni/dev/ontology-hub && python -c "
from backend.app.models.v2 import Category, Module
# Check Category has required fields
assert hasattr(Category, 'entity_key')
assert hasattr(Category, 'source_path')
assert hasattr(Category, 'canonical_json')
# Check Module has version
assert hasattr(Module, 'version')
print('Model structure verified')
"
```
</verification>

<success_criteria>
- backend/app/models/v2/ directory exists with 8 files (enums, ontology_version, 6 entity types, __init__)
- All models importable from `backend.app.models.v2`
- OntologyVersion has commit_sha, ingest_status fields
- All entity models have entity_key (unique, indexed), source_path, canonical_json
- Module and Bundle have version field
- No import errors or circular dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/08-database-foundation/08-01-SUMMARY.md`
</output>

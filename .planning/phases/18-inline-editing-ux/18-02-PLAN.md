---
phase: 18-inline-editing-ux
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - frontend/src/components/entity/detail/CategoryDetail.tsx
  - frontend/src/components/entity/detail/PropertyDetail.tsx
  - frontend/src/components/entity/sections/EntityHeader.tsx
autonomous: true

must_haves:
  truths:
    - "User sees pencil icon when hovering over editable label field in CategoryDetail"
    - "User sees pencil icon when hovering over editable description field"
    - "User can click pencil to edit label inline with save/cancel buttons"
    - "User sees delete icon on hover for deletable fields (like parent categories)"
    - "Editing works in both CategoryDetail and PropertyDetail"
  artifacts:
    - path: "frontend/src/components/entity/sections/EntityHeader.tsx"
      provides: "Updated header using InlineEditField for label/description"
      exports: ["EntityHeader"]
    - path: "frontend/src/components/entity/detail/CategoryDetail.tsx"
      provides: "Category detail with hover-reveal editing"
      exports: ["CategoryDetail"]
    - path: "frontend/src/components/entity/detail/PropertyDetail.tsx"
      provides: "Property detail with hover-reveal editing"
      exports: ["PropertyDetail"]
  key_links:
    - from: "EntityHeader.tsx"
      to: "InlineEditField"
      via: "import"
      pattern: "import.*InlineEditField"
    - from: "CategoryDetail.tsx"
      to: "InlineEditField"
      via: "component usage"
      pattern: "<InlineEditField"
---

<objective>
Integrate InlineEditField into detail modals for hover-reveal inline editing.

Purpose: Replace the current always-visible edit fields with the new hover-reveal pattern. When users hover over editable fields in draft mode, they see edit/delete icons. This implements EDIT-01, EDIT-02, and EDIT-04 from requirements.

Output: Updated EntityHeader, CategoryDetail, and PropertyDetail components using InlineEditField for intuitive hover-based editing.
</objective>

<execution_context>
@/home/daharoni/.claude/get-shit-done/workflows/execute-plan.md
@/home/daharoni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-inline-editing-ux/18-CONTEXT.md
@.planning/phases/18-inline-editing-ux/18-01-SUMMARY.md

# Components to update
@frontend/src/components/entity/sections/EntityHeader.tsx
@frontend/src/components/entity/detail/CategoryDetail.tsx
@frontend/src/components/entity/detail/PropertyDetail.tsx
@frontend/src/components/entity/form/InlineEditField.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update EntityHeader to use InlineEditField</name>
  <files>frontend/src/components/entity/sections/EntityHeader.tsx</files>
  <action>
Replace EditableField usage with InlineEditField for label and description:

**Current behavior:**
- Uses EditableField which shows input directly when isEditing=true
- Has revert buttons for modified values

**New behavior:**
- Use InlineEditField which shows hover-reveal icons
- Icons only appear in draft mode (isEditing=true)
- In view mode (isEditing=false), just display values without icons

**Changes:**
1. Import InlineEditField instead of (or in addition to) EditableField
2. For label field:
   - Use InlineEditField with isEditable={isEditing && !!onLabelChange}
   - Pass onSave={onLabelChange}
   - Keep VisualChangeMarker wrapper for showing modification status
3. For description field:
   - Same pattern as label
   - Use multiline variant if InlineEditField supports it, or handle separately

**Preserve:**
- Change status badge display
- Entity type badge display
- Entity key display

**If InlineEditField doesn't support multiline:**
- Keep EditableField for description (multiline)
- Use InlineEditField for label (single-line)
- This is acceptable as description often needs more space anyway

**Read-only fields:**
- entityKey is always read-only (no edit icon ever)
- entityType badge is always read-only
  </action>
  <verify>
- `npm run typecheck` passes
- EntityHeader imports InlineEditField
- Grep for `<InlineEditField` shows usage in component
  </verify>
  <done>
EntityHeader updated to use InlineEditField for label field with hover-reveal icons in draft mode. Description may use existing EditableField for multiline support.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CategoryDetail for hover-reveal editing</name>
  <files>frontend/src/components/entity/detail/CategoryDetail.tsx</files>
  <action>
Integrate InlineEditField and DeletedItemBadge into CategoryDetail:

**Fields to update:**
1. Label - via EntityHeader (already done in Task 1)
2. Description - via EntityHeader (already done in Task 1)
3. Parent categories list - Update EditableList integration

**Parent categories updates:**
- Current: EditableList shows X button always when isEditing=true
- New: Show X icon on hover per item using group-hover pattern
- Update renderItem callback to wrap each parent badge in hover container
- When a parent is removed, instead of filtering out, mark as deleted and show DeletedItemBadge

**Soft delete for parents:**
- Track deleted parents in local state: `const [deletedParents, setDeletedParents] = useState<Set<string>>(new Set())`
- When user clicks delete on parent: add to deletedParents Set, call handleRemoveParent
- Render deleted parents with DeletedItemBadge showing undo option
- Undo restores parent to editedParents and removes from deletedParents

**Note:** Per CONTEXT.md, deleted items stay in same position. Track deletion state rather than immediately removing.

**Implementation approach:**
- Create wrapper component or inline logic for parent items with hover icons
- On delete click: add parent to deletedParents, trigger saveChange with updated parents
- On undo click: remove from deletedParents, add back to editedParents, trigger saveChange

**Properties section:**
- Properties shown are a mix of direct and inherited
- Inherited properties are read-only (edit at source) per CONTEXT.md
- Direct properties could show delete icon on hover
- For MVP: Keep properties section as-is (read-only display), defer property editing to Phase 20 (entity management)
  </action>
  <verify>
- `npm run typecheck` passes
- CategoryDetail renders parent items with hover-reveal delete icons
- Deleted parents show DeletedItemBadge with undo option
  </verify>
  <done>
CategoryDetail updated with:
- Hover-reveal editing via EntityHeader
- Parent category items with hover delete icons
- Soft delete pattern with DeletedItemBadge and undo
  </done>
</task>

<task type="auto">
  <name>Task 3: Update PropertyDetail for hover-reveal editing</name>
  <files>frontend/src/components/entity/detail/PropertyDetail.tsx</files>
  <action>
Apply same hover-reveal pattern to PropertyDetail:

**Fields handled by EntityHeader (already updated):**
- Label
- Description

**Property-specific fields:**
- Datatype (Select dropdown) - Currently shows Select when isEditing=true
- Cardinality (Select dropdown) - Currently shows Select when isEditing=true

**Update approach for Select fields:**
- Wrap in hover container with edit icon
- View mode: Show current value as text with edit icon on hover
- Edit mode (after clicking edit): Show Select dropdown
- Save: Selecting new value saves immediately (Select has built-in onChange)
- Cancel: Add cancel button next to dropdown

**Implementation for Datatype/Cardinality:**
1. Add local state: `const [isEditingDatatype, setIsEditingDatatype] = useState(false)`
2. View mode:
   ```tsx
   <div className="group relative">
     <span>{editedDatatype}</span>
     {isEditing && (
       <button onClick={() => setIsEditingDatatype(true)} className="opacity-0 group-hover:opacity-100">
         <Pencil className="h-4 w-4" />
       </button>
     )}
   </div>
   ```
3. Edit mode:
   ```tsx
   <div className="flex gap-2">
     <Select value={editedDatatype} onValueChange={(v) => { handleDatatypeChange(v); setIsEditingDatatype(false); }}>
       ...
     </Select>
     <button onClick={() => setIsEditingDatatype(false)}><X /></button>
   </div>
   ```

**Used By section:**
- Read-only list of categories using this property
- No edit icons needed (clicking navigates to category)
  </action>
  <verify>
- `npm run typecheck` passes
- PropertyDetail shows hover-reveal edit icons for datatype and cardinality
- Clicking edit icon opens Select dropdown with cancel option
  </verify>
  <done>
PropertyDetail updated with hover-reveal editing for:
- Label/description via EntityHeader
- Datatype field with hover edit icon -> Select dropdown
- Cardinality field with hover edit icon -> Select dropdown
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with no errors
2. CategoryDetail and PropertyDetail import and use InlineEditField
3. Parent categories in CategoryDetail show hover delete icons
4. Deleted parents show soft delete visual treatment with undo
5. PropertyDetail datatype/cardinality have hover edit icons
</verification>

<success_criteria>
- EntityHeader uses InlineEditField for hover-reveal editing
- CategoryDetail parent categories have hover delete + soft delete UX
- PropertyDetail datatype/cardinality have hover edit icons
- All changes only visible in draft mode (isEditing=true)
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/18-inline-editing-ux/18-02-SUMMARY.md`
</output>

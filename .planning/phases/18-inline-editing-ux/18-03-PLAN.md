---
phase: 18-inline-editing-ux
plan: 03
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - frontend/src/components/entity/EntityDetailPanel.tsx
autonomous: true

must_haves:
  truths:
    - "User sees edit/delete icons when hovering over fields in EntityDetailPanel (draft mode)"
    - "User can edit label inline from the panel view"
    - "Editing in panel triggers same auto-save as modal editing"
  artifacts:
    - path: "frontend/src/components/entity/EntityDetailPanel.tsx"
      provides: "Detail panel with hover-reveal inline editing"
      exports: ["EntityDetailPanel"]
  key_links:
    - from: "EntityDetailPanel.tsx"
      to: "InlineEditField"
      via: "import"
      pattern: "import.*InlineEditField"
    - from: "EntityDetailPanel.tsx"
      to: "useAutoSave"
      via: "hook usage"
      pattern: "useAutoSave"
---

<objective>
Add hover-reveal inline editing to EntityDetailPanel (the expanded sidebar view).

Purpose: Implement EDIT-03 from requirements - edit/delete icons appear when viewing entity in the expanded sidebar view in draft mode. This allows quick edits without opening the full modal.

Output: Updated EntityDetailPanel with hover-reveal editing for label and description fields.
</objective>

<execution_context>
@/home/daharoni/.claude/get-shit-done/workflows/execute-plan.md
@/home/daharoni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-inline-editing-ux/18-CONTEXT.md
@.planning/phases/18-inline-editing-ux/18-01-SUMMARY.md

# Component to update
@frontend/src/components/entity/EntityDetailPanel.tsx
@frontend/src/components/entity/form/InlineEditField.tsx
@frontend/src/hooks/useAutoSave.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add editing capability to EntityDetailPanel</name>
  <files>frontend/src/components/entity/EntityDetailPanel.tsx</files>
  <action>
Transform EntityDetailPanel from read-only summary to editable view with hover icons:

**Current state:**
- Displays entity details in a Card
- Read-only - no edit capability
- Data passed as props from BrowsePage

**Required changes:**

1. **Add props for draft context:**
   ```tsx
   interface EntityDetailPanelProps {
     entityKey: string | null
     entityType?: string
     draftId?: string
     data?: unknown
     isLoading?: boolean
     error?: Error | null
   }
   ```
   (draftId already exists but may not be used)

2. **Add local edit state and auto-save:**
   ```tsx
   const [editedLabel, setEditedLabel] = useState('')
   const [editedDescription, setEditedDescription] = useState('')

   const { saveChange, isSaving } = useAutoSave({
     draftToken: draftId || '',
     entityType: entityType || 'category',
     entityKey: entityKey || '',
     debounceMs: 500,
   })
   ```

3. **Initialize state from data:**
   ```tsx
   useEffect(() => {
     if (data) {
       const entityData = data as Record<string, unknown>
       setEditedLabel(entityData.label as string || '')
       setEditedDescription(entityData.description as string || '')
     }
   }, [data])
   ```

4. **Replace static label display with InlineEditField:**
   ```tsx
   // In CardHeader, replace:
   <CardTitle className="text-2xl">{label}</CardTitle>

   // With:
   <InlineEditField
     value={editedLabel}
     onSave={(newLabel) => {
       setEditedLabel(newLabel)
       if (draftId) {
         saveChange([{ op: 'replace', path: '/label', value: newLabel }])
       }
     }}
     isEditable={!!draftId}
     className="text-2xl font-semibold"
   />
   ```

5. **Replace static description with InlineEditField:**
   ```tsx
   // In CardHeader, replace:
   {description && <CardDescription>{description}</CardDescription>}

   // With:
   <InlineEditField
     value={editedDescription}
     onSave={(newDesc) => {
       setEditedDescription(newDesc)
       if (draftId) {
         saveChange([{ op: 'replace', path: '/description', value: newDesc }])
       }
     }}
     isEditable={!!draftId}
     placeholder="Add description..."
     className="text-sm text-muted-foreground"
   />
   ```

6. **Add saving indicator:**
   ```tsx
   {isSaving && (
     <div className="absolute top-2 right-2 text-xs text-muted-foreground">
       Saving...
     </div>
   )}
   ```

**Scope limitations:**
- Only label and description are editable in panel view
- For full editing (parents, properties, etc.), user opens modal
- This keeps panel lightweight while enabling quick edits

**Import additions:**
- InlineEditField from '../form/InlineEditField'
- useAutoSave from '@/hooks/useAutoSave'
- useState, useEffect from 'react'
  </action>
  <verify>
- `npm run typecheck` passes
- EntityDetailPanel imports InlineEditField
- EntityDetailPanel imports useAutoSave
- Grep for `<InlineEditField` shows usage in component
  </verify>
  <done>
EntityDetailPanel updated with:
- InlineEditField for label with hover edit icon (draft mode only)
- InlineEditField for description with hover edit icon (draft mode only)
- Auto-save integration via useAutoSave hook
- Saving indicator
  </done>
</task>

<task type="auto">
  <name>Task 2: Test panel editing with manual verification</name>
  <files>frontend/src/components/entity/EntityDetailPanel.tsx</files>
  <action>
Verify the panel editing works correctly by examining the implementation:

**Check implementation:**
1. InlineEditField properly imports and renders
2. isEditable condition correctly checks for draftId
3. onSave callbacks correctly call saveChange with JSON Patch format
4. State initialization from data prop works

**Manual code review checklist:**
- [ ] InlineEditField imported correctly
- [ ] useAutoSave hook called with correct params
- [ ] State initialized in useEffect with data dependency
- [ ] onSave callback creates correct JSON Patch operations
- [ ] isEditable={!!draftId} ensures icons only show in draft mode
- [ ] Saving indicator positioned and styled correctly

**Edge cases to consider in implementation:**
- entityKey is null initially (loading state) - skip auto-save setup
- data changes when user selects different entity - reset state
- draftId might be undefined (browse mode) - disable editing

If any issues found during review, fix them in the same task.
  </action>
  <verify>
- Code review complete
- No TypeScript errors
- Implementation handles edge cases (null entityKey, undefined draftId, data changes)
  </verify>
  <done>
EntityDetailPanel implementation verified for:
- Correct InlineEditField integration
- Proper draft mode detection
- Auto-save callback wiring
- Edge case handling
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with no errors
2. EntityDetailPanel imports InlineEditField and useAutoSave
3. Label and description use InlineEditField with isEditable={!!draftId}
4. Hover over label/description in draft mode shows edit icon
5. Clicking edit icon enables inline editing with save/cancel
</verification>

<success_criteria>
- EntityDetailPanel shows hover edit icons in draft mode
- User can edit label/description inline without opening modal
- Edits trigger auto-save via useAutoSave hook
- No edit icons appear in browse mode (no draftId)
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/18-inline-editing-ux/18-03-SUMMARY.md`
</output>

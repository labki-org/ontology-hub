---
phase: 18-inline-editing-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/entity/form/InlineEditField.tsx
  - frontend/src/components/entity/form/DeletedItemBadge.tsx
autonomous: true

must_haves:
  truths:
    - "Hovering over an editable field row shows pencil and trash icons"
    - "Clicking pencil icon converts display to input with save/cancel buttons"
    - "Escape key cancels edit and reverts value"
    - "Deleted items show grayed-out styling with Deleted badge and undo icon"
  artifacts:
    - path: "frontend/src/components/entity/form/InlineEditField.tsx"
      provides: "Hover-reveal edit/delete inline field component"
      exports: ["InlineEditField"]
    - path: "frontend/src/components/entity/form/DeletedItemBadge.tsx"
      provides: "Soft delete visual indicator with undo"
      exports: ["DeletedItemBadge"]
  key_links:
    - from: "InlineEditField.tsx"
      to: "TailwindCSS group-hover"
      via: "CSS classes"
      pattern: "group-hover:"
    - from: "InlineEditField.tsx"
      to: "lucide-react icons"
      via: "import"
      pattern: "Pencil|Trash2|Check|X"
---

<objective>
Create core inline editing components with hover-reveal icons and soft delete patterns.

Purpose: Establish the foundational UI components for Phase 18's inline editing UX. These components implement the hover-to-reveal icon pattern from CONTEXT.md and will be used by all entity detail views.

Output: Two new React components - InlineEditField for editable fields with hover icons, and DeletedItemBadge for soft delete visual treatment.
</objective>

<execution_context>
@/home/daharoni/.claude/get-shit-done/workflows/execute-plan.md
@/home/daharoni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-inline-editing-ux/18-CONTEXT.md
@.planning/phases/18-inline-editing-ux/18-RESEARCH.md

# Existing form components for reference
@frontend/src/components/entity/form/EditableField.tsx
@frontend/src/components/entity/form/EditableList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InlineEditField component</name>
  <files>frontend/src/components/entity/form/InlineEditField.tsx</files>
  <action>
Create InlineEditField component implementing the hover-reveal edit pattern from CONTEXT.md and RESEARCH.md:

**Structure:**
- View mode: Display value with hidden edit/delete icons that appear on hover
- Edit mode: Controlled input with explicit save/cancel buttons
- Props: value, onSave, onDelete (optional), isEditable, isDeletable, label (optional), placeholder, className

**View mode implementation:**
- Wrap in `div` with `group` class for TailwindCSS group-hover
- Add subtle row highlight on hover: `hover:bg-gray-50 dark:hover:bg-gray-800`
- Position icon container absolutely on right: `absolute right-2 top-1/2 -translate-y-1/2`
- Icons hidden by default, visible on hover: `opacity-0 group-hover:opacity-100`
- Use Lucide icons: Pencil for edit, Trash2 for delete
- Icon styling: `h-4 w-4 text-muted-foreground hover:text-foreground` for edit, `hover:text-destructive` for delete

**Edit mode implementation:**
- Replace display with controlled Input component
- Show Check (save) and X (cancel) buttons next to input
- Use useRef + useEffect to auto-focus input when entering edit mode
- Auto-select text on focus for easy replacement

**Keyboard handlers:**
- Escape: Cancel edit, revert to original value
- Enter: Save (single-line only)

**Click-away behavior (per CONTEXT.md - Claude's discretion):**
- Discard changes silently on click-away (simpler UX, explicit save required)
- Use onBlur with check that relatedTarget is not save button

**Icons to import from lucide-react:**
- Pencil, Trash2, Check, X

**Do NOT:**
- Use contentEditable (has React sync issues)
- Show icons when isEditable=false and isDeletable=false
- Validate on change (wait for save attempt per "punish late" pattern)
  </action>
  <verify>
- `npm run typecheck` passes
- Component file exists at expected path
- Grep for `group-hover:` confirms hover pattern implemented
- Grep for `Pencil.*Trash2` or similar confirms icons imported
  </verify>
  <done>
InlineEditField component created with:
- Hover-reveal pencil/trash icons using TailwindCSS group-hover
- Edit mode with controlled input and explicit save/cancel
- Keyboard handlers for Escape (cancel) and Enter (save)
- Auto-focus on edit mode entry
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DeletedItemBadge component</name>
  <files>frontend/src/components/entity/form/DeletedItemBadge.tsx</files>
  <action>
Create DeletedItemBadge component for soft delete visual treatment per CONTEXT.md:

**Props:**
- label: string (the item's display name)
- onUndo: () => void (callback to restore item)
- className?: string (optional additional styling)

**Visual treatment:**
- Grayed out styling: `opacity-50` on container
- Strike-through text: `line-through text-muted-foreground`
- "Deleted" badge: Use existing Badge component with `variant="secondary"` and small text
- Undo icon: Undo2 from lucide-react, positioned after badge
- Undo button styling: `text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300`

**Layout:**
- Flex container with items centered
- Content: [struck-through label] [Deleted badge] [Undo icon button]
- Gap between elements for readability

**Icons to import:**
- Undo2 from lucide-react

**Accessibility:**
- Undo button should have aria-label="Undo deletion"
- Button should be keyboard-focusable
  </action>
  <verify>
- `npm run typecheck` passes
- Component file exists at expected path
- Grep for `Undo2` confirms icon imported
- Grep for `line-through` confirms strike-through styling
  </verify>
  <done>
DeletedItemBadge component created with:
- Grayed-out, strike-through styling for deleted items
- "Deleted" badge indicator
- Undo icon button for easy reversal
- Proper accessibility attributes
  </done>
</task>

<task type="auto">
  <name>Task 3: Create unit tests for InlineEditField</name>
  <files>frontend/src/components/entity/form/InlineEditField.test.tsx</files>
  <action>
Create tests for InlineEditField component to verify hover and edit behavior:

**Test cases:**
1. "renders value in view mode" - Verify label/value displayed
2. "shows edit and delete icons on hover" - Verify icons become visible (may need to check class changes)
3. "enters edit mode when pencil clicked" - Verify input appears, value pre-filled
4. "calls onSave with new value when check clicked" - Verify callback
5. "reverts value when X clicked" - Verify original value restored
6. "reverts value when Escape pressed" - Verify keyboard handling
7. "saves value when Enter pressed" - Verify keyboard handling
8. "calls onDelete when trash clicked" - Verify callback
9. "hides delete icon when isDeletable=false" - Verify conditional rendering
10. "hides edit icon when isEditable=false" - Verify conditional rendering

**Test setup:**
- Use @testing-library/react
- Use userEvent for interactions
- Mock onSave and onDelete callbacks with vi.fn()

**Note:** Hover state testing with group-hover CSS may be limited - focus on functional behavior (click, keyboard, callbacks).
  </action>
  <verify>
- `npm test -- InlineEditField.test.tsx` passes all tests
- Test file exists at expected path
  </verify>
  <done>
Test suite created with coverage for:
- View mode rendering
- Edit mode transitions
- Keyboard shortcuts (Escape, Enter)
- Save/cancel/delete callbacks
- Conditional icon visibility
  </done>
</task>

</tasks>

<verification>
1. Both component files exist and export correctly
2. `npm run typecheck` passes with no errors
3. `npm test -- InlineEditField.test.tsx` passes
4. Manual inspection: Components use TailwindCSS group-hover pattern
5. Manual inspection: Lucide icons (Pencil, Trash2, Check, X, Undo2) imported
</verification>

<success_criteria>
- InlineEditField component created with hover-reveal edit/delete icons
- DeletedItemBadge component created with soft delete visual treatment
- Both components follow established project patterns (TailwindCSS, Lucide, shadcn/ui)
- Test suite passes for InlineEditField
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/18-inline-editing-ux/18-01-SUMMARY.md`
</output>

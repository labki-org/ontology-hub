---
phase: 20-entity-management
plan: 03
type: execute
wave: 2
depends_on: ["20-01", "20-02"]
files_modified:
  - frontend/src/components/entity/forms/TemplateForm.tsx
  - frontend/src/components/entity/forms/ModuleForm.tsx
  - frontend/src/components/entity/forms/BundleForm.tsx
autonomous: true

must_haves:
  truths:
    - "User can fill template form including wikitext field"
    - "User can fill module form and see error if no entities selected"
    - "User can fill bundle form and see error if no modules selected"
  artifacts:
    - path: "frontend/src/components/entity/forms/TemplateForm.tsx"
      provides: "Template creation form with wikitext textarea"
      min_lines: 60
    - path: "frontend/src/components/entity/forms/ModuleForm.tsx"
      provides: "Module creation form with version field"
      min_lines: 80
    - path: "frontend/src/components/entity/forms/BundleForm.tsx"
      provides: "Bundle creation form with version and modules"
      min_lines: 70
  key_links:
    - from: "frontend/src/components/entity/forms/ModuleForm.tsx"
      to: "./schemas"
      via: "moduleSchema import"
      pattern: "import.*moduleSchema"
    - from: "frontend/src/components/entity/forms/BundleForm.tsx"
      to: "./schemas"
      via: "bundleSchema import"
      pattern: "import.*bundleSchema"
---

<objective>
Create the complex entity forms (Template, Module, Bundle). Module and Bundle have version fields and require relationship selections, but the relationship combobox will be integrated in Plan 05. For now, use placeholder arrays.

Purpose: Complete the remaining 3 entity type forms. Module/Bundle have additional version field and relationship requirements.
Output: TemplateForm.tsx, ModuleForm.tsx, BundleForm.tsx
</objective>

<execution_context>
@/home/daharoni/.claude/get-shit-done/workflows/execute-plan.md
@/home/daharoni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-entity-management/20-CONTEXT.md
@.planning/phases/20-entity-management/20-RESEARCH.md
@frontend/src/components/entity/forms/CategoryForm.tsx
@frontend/src/components/entity/forms/schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TemplateForm component</name>
  <files>
    frontend/src/components/entity/forms/TemplateForm.tsx
  </files>
  <action>
Create TemplateForm.tsx following the established pattern:

1. Same setup as CategoryForm with templateSchema

2. Fields in order:
   - ID: Input with placeholder "template-name"
   - Label: Input
   - Description: Textarea
   - Wikitext: Textarea (larger, monospace font)

3. Wikitext field styling:
   ```tsx
   <Textarea
     {...field}
     placeholder="{{#template:...}}"
     className="font-mono min-h-[150px]"
     aria-invalid={!!form.formState.errors.wikitext}
   />
   ```

4. Same Cancel/Create button pattern
  </action>
  <verify>
    - TemplateForm.tsx uses templateSchema
    - Wikitext field renders as large monospace textarea
    - Form validates all 4 required fields
  </verify>
  <done>
    - TemplateForm includes wikitext field with monospace styling
    - Validation enforces non-empty wikitext
    - Ready for CreateEntityModal integration
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ModuleForm with version field</name>
  <files>
    frontend/src/components/entity/forms/ModuleForm.tsx
  </files>
  <action>
Create ModuleForm.tsx:

1. Setup with moduleSchema (which has superRefine for at-least-one validation)

2. Fields in order:
   - ID: Input
   - Version: Input with placeholder "1.0.0"
   - Label: Input
   - Description: Textarea

3. Relationship placeholders (will be replaced with EntityCombobox in Plan 05):
   ```tsx
   {/* Placeholder - categories, properties, subobjects, templates will use EntityCombobox */}
   <div className="space-y-2">
     <Label>Included Entities</Label>
     <p className="text-sm text-muted-foreground">
       Add categories, properties, subobjects, or templates after creation.
     </p>
   </div>
   ```

4. Show form-level error for "at least one entity required" from superRefine:
   ```tsx
   {form.formState.errors.root && (
     <p className="text-sm text-red-600" role="alert">
       {form.formState.errors.root.message}
     </p>
   )}
   ```

5. For now, default the arrays to empty and allow creation - the superRefine warning can be addressed post-creation when editing.

   Alternative: Add a hidden checkbox field that user must acknowledge "Will add entities after creation"
  </action>
  <verify>
    - ModuleForm.tsx uses moduleSchema
    - Version field has placeholder "1.0.0"
    - Has placeholder section for entity relationships
    - Form-level errors display properly
  </verify>
  <done>
    - ModuleForm has all required fields including version
    - Placeholder ready for EntityCombobox integration
    - User can create module shell, then add entities
  </done>
</task>

<task type="auto">
  <name>Task 3: Create BundleForm with modules requirement</name>
  <files>
    frontend/src/components/entity/forms/BundleForm.tsx
  </files>
  <action>
Create BundleForm.tsx:

1. Setup with bundleSchema

2. Fields in order:
   - ID: Input
   - Version: Input with placeholder "1.0.0"
   - Label: Input
   - Description: Textarea

3. Modules relationship placeholder (will be replaced with EntityCombobox in Plan 05):
   ```tsx
   <div className="space-y-2">
     <Label>
       Modules <span className="text-red-600" aria-label="required">*</span>
     </Label>
     <p className="text-sm text-muted-foreground">
       Add modules after creation. At least one module is required.
     </p>
   </div>
   ```

4. Since bundleSchema requires modules.min(1), the form will show validation error until modules are added. For initial creation, we can:
   - Option A: Skip modules validation for create (use separate createSchema)
   - Option B: Add a "temporary" module that gets replaced

   **Choose Option A:** Create bundleCreateSchema without modules.min(1), then full bundleSchema for editing.

5. Update schemas.ts to export bundleCreateSchema (relaxed version)
  </action>
  <verify>
    - BundleForm.tsx renders all required fields
    - Version field present with placeholder
    - Modules section shows as required with placeholder text
    - Form can submit for initial creation (relaxed validation)
  </verify>
  <done>
    - BundleForm includes version field
    - Relaxed validation allows creation without modules initially
    - Full validation enforced when editing
  </done>
</task>

</tasks>

<verification>
1. Run `cd /home/daharoni/dev/ontology-hub/frontend && npm run build` - should pass
2. Verify all 3 forms export properly
3. Verify ModuleForm and BundleForm have version fields
4. Verify placeholder sections for relationship management
</verification>

<success_criteria>
- TemplateForm has wikitext textarea with monospace font
- ModuleForm has version field and entity relationship placeholder
- BundleForm has version field and modules requirement indicator
- All forms follow established validation patterns
</success_criteria>

<output>
After completion, create `.planning/phases/20-entity-management/20-03-SUMMARY.md`
</output>

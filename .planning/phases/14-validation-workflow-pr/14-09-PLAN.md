---
phase: 14-validation-workflow-pr
plan: 09
type: execute
wave: 5
depends_on: ["14-07", "14-08"]
files_modified:
  - frontend/src/components/draft/PRWizard.tsx
  - frontend/src/components/draft/PRWizardSteps/ReviewChanges.tsx
  - frontend/src/components/draft/PRWizardSteps/EditDetails.tsx
  - frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx
autonomous: true

must_haves:
  truths:
    - "PR wizard opens as modal dialog with three steps"
    - "Step 1 shows change summary (diff overview)"
    - "Step 2 allows editing PR title and adding user comment"
    - "Step 3 initiates GitHub OAuth redirect and shows submission progress"
    - "After success, shows PR URL link"
  artifacts:
    - path: "frontend/src/components/draft/PRWizard.tsx"
      provides: "Multi-step PR submission wizard"
      exports: ["PRWizard"]
    - path: "frontend/src/components/draft/PRWizardSteps/ReviewChanges.tsx"
      provides: "Step 1: Review changes"
      exports: ["ReviewChanges"]
    - path: "frontend/src/components/draft/PRWizardSteps/EditDetails.tsx"
      provides: "Step 2: Edit PR details"
      exports: ["EditDetails"]
    - path: "frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx"
      provides: "Step 3: Confirm and submit"
      exports: ["ConfirmSubmit"]
  key_links:
    - from: "frontend/src/components/draft/PRWizard.tsx"
      to: "@radix-ui/react-dialog"
      via: "Dialog component for modal"
      pattern: "Dialog"
    - from: "frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx"
      to: "/api/oauth/github/login"
      via: "Redirect to OAuth login with draft_token param"
      pattern: "oauth/github/login"
---

<objective>
Create multi-step PR submission wizard using Radix Dialog.

Purpose: Per CONTEXT.md, PR submission uses a wizard flow: review changes, edit PR details, confirm and submit. The wizard initiates GitHub OAuth at submission time using a redirect approach (matching the existing v1 pattern).

Output: PRWizard.tsx with three step components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-validation-workflow-pr/14-CONTEXT.md
@.planning/phases/14-validation-workflow-pr/14-RESEARCH.md

# Prior plan summaries
@.planning/phases/14-validation-workflow-pr/14-06-SUMMARY.md
@.planning/phases/14-validation-workflow-pr/14-07-SUMMARY.md
@.planning/phases/14-validation-workflow-pr/14-08-SUMMARY.md

# Existing OAuth pattern
@backend/app/routers/oauth.py

# Existing Dialog component
# frontend/src/components/ui/dialog.tsx (shadcn)

# Draft API hooks and store
# frontend/src/api/draftApiV2.ts
# frontend/src/stores/draftStoreV2.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PRWizard container, ReviewChanges, and EditDetails components</name>
  <files>
    frontend/src/components/draft/PRWizard.tsx
    frontend/src/components/draft/PRWizardSteps/ReviewChanges.tsx
    frontend/src/components/draft/PRWizardSteps/EditDetails.tsx
  </files>
  <action>
Create the wizard container and the first two step components:

1. PRWizard.tsx (container):

Props:
- open: boolean
- onOpenChange: (open: boolean) => void
- draftToken: string
- changes: DraftChangeV2[]
- validationReport: ValidationReportV2

State:
- step: 'review' | 'details' | 'confirm' | 'success'
- prTitle: string (auto-generated from draft title or change count)
- userComment: string
- submittedPrUrl: string | null
- submitError: string | null

Layout:
- Use Dialog (from shadcn/ui) with DialogContent max-w-2xl
- Step progress indicator at top: three dots/labels showing current step
- Content area renders current step component
- Step transitions via onNext/onBack callbacks

Auto-generate default PR title: "Schema update: {draft.title || 'N changes'}"

On mount, check URL for pr_url param (set by OAuth callback redirect). If found, set step to 'success' and submittedPrUrl to the param value.

2. ReviewChanges.tsx (Step 1):

Props:
- changes: DraftChangeV2[]
- validationReport: ValidationReportV2
- onNext: () => void

Layout:
- Title: "Review Changes"
- Description: "Review the changes that will be included in the pull request."
- Change summary (condensed version of DraftDiffViewerV2):
  - Count per type: "+{N} added, ~{M} modified, -{K} deleted"
  - List of entity_keys grouped by change type (compact)
- Validation status: pass/fail badge + error/warning counts
- Semver suggestion badge
- "Next" button at bottom right

3. EditDetails.tsx (Step 2):

Props:
- prTitle: string
- userComment: string
- onPrTitleChange: (title: string) => void
- onUserCommentChange: (comment: string) => void
- onNext: () => void
- onBack: () => void

Layout:
- Title: "PR Details"
- Description: "The PR description is auto-generated. You can customize the title and add a comment."
- PR Title field: Input with label, pre-filled with auto-generated title
- User Comment field: Textarea with label, optional
  - Placeholder: "Add any additional context for reviewers..."
- Note: "The PR body will be auto-generated from your changes and validation results. Your comment will be included."
- "Back" and "Next" buttons
  </action>
  <verify>cd /home/daharoni/dev/ontology-hub/frontend && ls src/components/draft/PRWizardSteps/ && npx tsc --noEmit --skipLibCheck src/components/draft/PRWizard.tsx 2>&1 | head -20</verify>
  <done>PRWizard container, ReviewChanges, and EditDetails components exist and compile</done>
</task>

<task type="auto">
  <name>Task 2: Create ConfirmSubmit component with OAuth redirect flow</name>
  <files>
    frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx
  </files>
  <action>
Create the final wizard step that handles submission via GitHub OAuth redirect:

ConfirmSubmit.tsx (Step 3):

Props:
- draftToken: string
- prTitle: string
- userComment: string
- onBack: () => void
- onSuccess: (prUrl: string) => void
- onError: (error: string) => void

Layout has two sub-states:

a. Pre-submit state:
- Title: "Submit Pull Request"
- Summary: "This will create a GitHub PR with {N} changes."
- "You will be redirected to GitHub to authorize Ontology Hub to create a PR on your behalf."
- "Submit" button (primary, prominent) + "Back" button

b. Success state (rendered by PRWizard when pr_url is present after redirect):
- CheckCircle icon (green)
- "Pull request created successfully!"
- PR URL as clickable link (opens in new tab)
- "Close" button

OAuth flow (redirect approach — matching v1 pattern):
- On "Submit" click, redirect the browser to: /api/oauth/github/login?draft_token={draftToken}&pr_title={encodeURIComponent(prTitle)}&user_comment={encodeURIComponent(userComment)}
- The existing OAuth callback (backend/app/routers/oauth.py) handles:
  1. GitHub authorization
  2. PR creation using the user's OAuth token
  3. Redirect back to the app with pr_url as a URL parameter
- The frontend does NOT need to recover wizard state after redirect. The backend handles PR creation entirely within the OAuth callback flow. After redirect back, the app reads pr_url from URL params and shows success.

Do NOT implement a popup approach. Do NOT check for existing tokens. Use the redirect approach exclusively — the backend OAuth callback handles everything after the redirect.

Pass pr_title and user_comment as query params on the OAuth login URL so the backend can use them when creating the PR. The existing oauth.py stores these in the session alongside the draft_token.
  </action>
  <verify>cd /home/daharoni/dev/ontology-hub/frontend && npx tsc --noEmit --skipLibCheck src/components/draft/PRWizardSteps/ConfirmSubmit.tsx 2>&1 | head -20</verify>
  <done>ConfirmSubmit component uses redirect approach for OAuth flow — clicking Submit redirects to /api/oauth/github/login with draft_token, pr_title, and user_comment params</done>
</task>

</tasks>

<verification>
- PRWizard.tsx and all three step files exist
- Dialog opens with step progression
- Step 1 shows change summary
- Step 2 has PR title and comment fields
- Step 3 initiates OAuth redirect (not popup)
- All components compile without TypeScript errors
</verification>

<success_criteria>
- Wizard has three distinct steps with back/next navigation
- Step progress indicator shows current position
- PR title auto-generated from draft
- User can add custom comment
- Submit redirects to /api/oauth/github/login with draft_token param
- After OAuth callback redirect, app shows PR URL link
</success_criteria>

<output>
After completion, create `.planning/phases/14-validation-workflow-pr/14-09-SUMMARY.md`
</output>

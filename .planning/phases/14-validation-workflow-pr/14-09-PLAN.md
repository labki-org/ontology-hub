---
phase: 14-validation-workflow-pr
plan: 09
type: execute
wave: 5
depends_on: ["14-07", "14-08"]
files_modified:
  - frontend/src/components/draft/PRWizard.tsx
  - frontend/src/components/draft/PRWizardSteps/ReviewChanges.tsx
  - frontend/src/components/draft/PRWizardSteps/EditDetails.tsx
  - frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx
autonomous: true

must_haves:
  truths:
    - "PR wizard opens as modal dialog with three steps"
    - "Step 1 shows change summary (diff overview)"
    - "Step 2 allows editing PR title and adding user comment"
    - "Step 3 initiates GitHub OAuth and shows submission progress"
    - "After success, shows PR URL link"
  artifacts:
    - path: "frontend/src/components/draft/PRWizard.tsx"
      provides: "Multi-step PR submission wizard"
      exports: ["PRWizard"]
    - path: "frontend/src/components/draft/PRWizardSteps/ReviewChanges.tsx"
      provides: "Step 1: Review changes"
      exports: ["ReviewChanges"]
    - path: "frontend/src/components/draft/PRWizardSteps/EditDetails.tsx"
      provides: "Step 2: Edit PR details"
      exports: ["EditDetails"]
    - path: "frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx"
      provides: "Step 3: Confirm and submit"
      exports: ["ConfirmSubmit"]
  key_links:
    - from: "frontend/src/components/draft/PRWizard.tsx"
      to: "@radix-ui/react-dialog"
      via: "Dialog component for modal"
      pattern: "Dialog"
    - from: "frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx"
      to: "frontend/src/api/draftApiV2.ts"
      via: "OAuth login initiation"
      pattern: "oauth.*github.*login"
---

<objective>
Create multi-step PR submission wizard using Radix Dialog.

Purpose: Per CONTEXT.md, PR submission uses a wizard flow: review changes, edit PR details, confirm and submit. The wizard initiates GitHub OAuth at submission time (existing v1 pattern).

Output: PRWizard.tsx with three step components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-validation-workflow-pr/14-CONTEXT.md
@.planning/phases/14-validation-workflow-pr/14-RESEARCH.md

# Prior plan summaries
@.planning/phases/14-validation-workflow-pr/14-06-SUMMARY.md
@.planning/phases/14-validation-workflow-pr/14-07-SUMMARY.md
@.planning/phases/14-validation-workflow-pr/14-08-SUMMARY.md

# Existing OAuth pattern
@backend/app/routers/oauth.py

# Existing Dialog component
# frontend/src/components/ui/dialog.tsx (shadcn)

# Draft API hooks and store
# frontend/src/api/draftApiV2.ts
# frontend/src/stores/draftStoreV2.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PRWizard container and step components</name>
  <files>
    frontend/src/components/draft/PRWizard.tsx
    frontend/src/components/draft/PRWizardSteps/ReviewChanges.tsx
    frontend/src/components/draft/PRWizardSteps/EditDetails.tsx
    frontend/src/components/draft/PRWizardSteps/ConfirmSubmit.tsx
  </files>
  <action>
Create the wizard container and its three step components:

1. PRWizard.tsx (container):

Props:
- open: boolean
- onOpenChange: (open: boolean) => void
- draftToken: string
- changes: DraftChangeV2[]
- validationReport: ValidationReportV2

State:
- step: 'review' | 'details' | 'confirm' | 'success'
- prTitle: string (auto-generated from draft title or change count)
- userComment: string
- submittedPrUrl: string | null
- submitError: string | null

Layout:
- Use Dialog (from shadcn/ui) with DialogContent max-w-2xl
- Step progress indicator at top: three dots/labels showing current step
- Content area renders current step component
- Step transitions via onNext/onBack callbacks

Auto-generate default PR title: "Schema update: {draft.title || 'N changes'}"

2. ReviewChanges.tsx (Step 1):

Props:
- changes: DraftChangeV2[]
- validationReport: ValidationReportV2
- onNext: () => void

Layout:
- Title: "Review Changes"
- Description: "Review the changes that will be included in the pull request."
- Change summary (condensed version of DraftDiffViewerV2):
  - Count per type: "+{N} added, ~{M} modified, -{K} deleted"
  - List of entity_keys grouped by change type (compact)
- Validation status: pass/fail badge + error/warning counts
- Semver suggestion badge
- "Next" button at bottom right

3. EditDetails.tsx (Step 2):

Props:
- prTitle: string
- userComment: string
- onPrTitleChange: (title: string) => void
- onUserCommentChange: (comment: string) => void
- onNext: () => void
- onBack: () => void

Layout:
- Title: "PR Details"
- Description: "The PR description is auto-generated. You can customize the title and add a comment."
- PR Title field: Input with label, pre-filled with auto-generated title
- User Comment field: Textarea with label, optional
  - Placeholder: "Add any additional context for reviewers..."
- Note: "The PR body will be auto-generated from your changes and validation results. Your comment will be included."
- "Back" and "Next" buttons

4. ConfirmSubmit.tsx (Step 3):

Props:
- draftToken: string
- prTitle: string
- userComment: string
- onBack: () => void
- onSuccess: (prUrl: string) => void
- onError: (error: string) => void

Layout (three sub-states):

a. Pre-submit state:
- Title: "Submit Pull Request"
- Summary: "This will create a GitHub PR with {N} changes."
- "You will be redirected to GitHub to authorize Ontology Hub to create a PR on your behalf."
- "Submit" button (primary, prominent) + "Back" button

b. Submitting state (after clicking Submit):
- Spinner with "Creating pull request..."
- Disable all buttons

c. Success state (after PR created):
- CheckCircle icon (green)
- "Pull request created successfully!"
- PR URL as clickable link (opens in new tab)
- "Close" button

OAuth flow:
- On "Submit" click, redirect to: /api/oauth/github/login?draft_token={draftToken}
- The existing OAuth callback will handle PR creation and redirect back
- BUT for v2: Instead of OAuth redirect, use the submit endpoint directly if we already have a token
- Check if there's an existing GitHub token in session first
- If no token: redirect to OAuth login (same as v1 pattern)
- If token exists: call useSubmitDraft mutation directly

For simplicity in v2:
- Use the existing OAuth flow: clicking "Submit" opens /api/oauth/github/login?draft_token={token} in the same window
- After OAuth callback, redirect back to the app with pr_url parameter
- The app reads pr_url from URL params and shows success state

Alternatively (if the OAuth flow can be adapted):
- Open OAuth in popup window
- After callback, popup sends message to parent
- Parent receives token and calls submit mutation

Use the simpler redirect approach (matching v1 pattern) unless the popup approach is already implemented.
  </action>
  <verify>cd /home/daharoni/dev/ontology-hub/frontend && ls src/components/draft/PRWizardSteps/ && npx tsc --noEmit --skipLibCheck src/components/draft/PRWizard.tsx 2>&1 | head -20</verify>
  <done>PRWizard with three step components exists and compiles</done>
</task>

</tasks>

<verification>
- PRWizard.tsx and all three step files exist
- Dialog opens with step progression
- Step 1 shows change summary
- Step 2 has PR title and comment fields
- Step 3 initiates OAuth/submission flow
- All components compile without TypeScript errors
</verification>

<success_criteria>
- Wizard has three distinct steps with back/next navigation
- Step progress indicator shows current position
- PR title auto-generated from draft
- User can add custom comment
- Submit initiates OAuth flow (redirect to GitHub)
- Success state shows PR URL link
</success_criteria>

<output>
After completion, create `.planning/phases/14-validation-workflow-pr/14-09-SUMMARY.md`
</output>

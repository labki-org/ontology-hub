---
phase: 12-frontend-graph-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/components/layout/SplitLayout.tsx
  - frontend/src/api/entitiesV2.ts
  - frontend/src/api/types.ts
autonomous: true

must_haves:
  truths:
    - "Split panels resize vertically with drag handle"
    - "Panel sizes persist across page reloads"
    - "v2 API client fetches entities with draft_id support"
  artifacts:
    - path: "frontend/src/components/layout/SplitLayout.tsx"
      provides: "Resizable panel layout"
      min_lines: 20
    - path: "frontend/src/api/entitiesV2.ts"
      provides: "v2 entity API client with draft support"
      exports: ["useCategories", "useCategory", "useProperties", "useModules", "useBundles"]
  key_links:
    - from: "frontend/src/api/entitiesV2.ts"
      to: "/api/v2/categories"
      via: "apiFetch"
      pattern: "apiFetch.*api/v2"
---

<objective>
Install new dependencies and create core layout components for the unified browse/draft interface.

Purpose: Establish foundational infrastructure (react-resizable-panels, d3-polygon, d3-force) and create split-panel layout with v2 API client hooks.
Output: Working split-panel layout component and v2 API hooks ready for graph and sidebar integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/intel/summary.md
@.planning/phases/12-frontend-graph-visualization/12-CONTEXT.md
@.planning/phases/12-frontend-graph-visualization/12-RESEARCH.md
@frontend/package.json
@frontend/src/api/client.ts
@frontend/src/api/entities.ts
@frontend/src/api/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install frontend dependencies</name>
  <files>frontend/package.json</files>
  <action>
Install the required new packages for graph visualization and split panels:

```bash
cd frontend && npm install d3-polygon d3-force react-resizable-panels
```

Also install type definitions:
```bash
cd frontend && npm install -D @types/d3-polygon @types/d3-force
```

The research confirms these versions:
- d3-polygon: ~3.0.1
- d3-force: ~3.0.0 (NOT v7 - v7 has breaking changes)
- react-resizable-panels: latest stable
  </action>
  <verify>`cd frontend && npm ls d3-polygon d3-force react-resizable-panels` shows all installed</verify>
  <done>All three packages installed and listed in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create SplitLayout component</name>
  <files>frontend/src/components/layout/SplitLayout.tsx</files>
  <action>
Create a new SplitLayout component using react-resizable-panels for the graph/detail split view.

Based on CONTEXT.md decisions:
- Split-panel layout: graph panel on top, detail panel on bottom
- Layout persists across navigation

Implementation:
1. Import PanelGroup, Panel, PanelResizeHandle from react-resizable-panels
2. Create SplitLayout that wraps two children (graph and detail)
3. Use `direction="vertical"` for top/bottom split
4. Use `autoSaveId="browse-layout"` for persistence
5. Default 60% graph / 40% detail with minSize constraints
6. Style resize handle with Tailwind (h-1.5, bg-border, hover:bg-primary transition)

Props: children (two React nodes), optional className for container.

Export SplitLayout as named export.
  </action>
  <verify>Import works: add `import { SplitLayout } from '@/components/layout/SplitLayout'` to a test file</verify>
  <done>SplitLayout component exists with PanelGroup, handles resize, persists sizes via localStorage</done>
</task>

<task type="auto">
  <name>Task 3: Create v2 entity API hooks</name>
  <files>frontend/src/api/entitiesV2.ts, frontend/src/api/types.ts</files>
  <action>
Create new API hooks for v2 endpoints that support draft_id parameter.

First, add new types to types.ts:
```typescript
// v2 Entity types with change status
export interface EntityWithStatus {
  entity_key: string
  label: string
  description?: string | null
  change_status?: 'added' | 'modified' | 'deleted' | 'unchanged'
  deleted?: boolean
}

export interface EntityListResponseV2 {
  items: EntityWithStatus[]
  next_cursor: string | null
  has_next: boolean
}

export interface CategoryDetailV2 {
  entity_key: string
  label: string
  description?: string | null
  parents: string[]
  properties: PropertyProvenance[]
  change_status?: 'added' | 'modified' | 'deleted' | 'unchanged'
  deleted?: boolean
  patch_error?: string
}

export interface PropertyProvenance {
  entity_key: string
  label: string
  is_direct: boolean
  is_inherited: boolean
  is_required: boolean
  source_category: string
  inheritance_depth: number
}
```

Then create entitiesV2.ts with hooks:
- useCategories(cursor?, limit?, draftId?) - list categories
- useCategory(entityKey, draftId?) - single category detail
- useProperties(cursor?, limit?, draftId?) - list properties
- useProperty(entityKey, draftId?) - single property
- useSubobjects(cursor?, limit?, draftId?) - list subobjects
- useModules(cursor?, limit?, draftId?) - list modules
- useBundles(cursor?, limit?, draftId?) - list bundles
- useTemplates(cursor?, limit?, draftId?) - list templates

Each hook:
1. Uses useQuery from @tanstack/react-query
2. Adds draft_id to query params if provided
3. Includes draftId in queryKey for cache separation
4. Uses apiFetch from ./client with /api/v2 prefix

Follow existing pattern from entities.ts but target v2 endpoints.
  </action>
  <verify>`tsc --noEmit` passes for entitiesV2.ts; hooks import without errors</verify>
  <done>All 8 entity hooks created, types exported, draft_id param flows through to API calls</done>
</task>

</tasks>

<verification>
1. `cd frontend && npm ls d3-polygon d3-force react-resizable-panels` shows all installed
2. `cd frontend && npx tsc --noEmit` passes without errors
3. Import SplitLayout and verify no TypeScript errors
</verification>

<success_criteria>
- All three packages installed in package.json
- SplitLayout component renders resizable vertical panels
- v2 API hooks fetch from /api/v2/* endpoints with optional draft_id
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-graph-visualization/12-01-SUMMARY.md`
</output>

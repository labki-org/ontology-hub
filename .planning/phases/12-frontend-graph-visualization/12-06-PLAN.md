---
phase: 12-frontend-graph-visualization
plan: 06
type: execute
wave: 3
depends_on: ["12-03", "12-04", "12-05"]
files_modified:
  - frontend/src/pages/BrowsePage.tsx
  - frontend/src/components/layout/MainLayoutV2.tsx
  - frontend/src/App.tsx
  - frontend/src/components/entity/EntityDetailPanel.tsx
autonomous: true

must_haves:
  truths:
    - "BrowsePage shows split layout with graph and detail panels"
    - "Same UI serves both canonical browse and draft mode"
    - "URL draft_id parameter activates draft context"
    - "Selecting entity in sidebar/graph updates detail panel"
  artifacts:
    - path: "frontend/src/pages/BrowsePage.tsx"
      provides: "Unified browse/draft page"
      min_lines: 60
    - path: "frontend/src/components/layout/MainLayoutV2.tsx"
      provides: "v2 layout with sidebar and draft banner"
      min_lines: 40
    - path: "frontend/src/components/entity/EntityDetailPanel.tsx"
      provides: "Entity detail in bottom panel"
      min_lines: 40
  key_links:
    - from: "frontend/src/pages/BrowsePage.tsx"
      to: "SplitLayout"
      via: "import"
      pattern: "SplitLayout"
    - from: "frontend/src/pages/BrowsePage.tsx"
      to: "graphStore"
      via: "useGraphStore"
      pattern: "useGraphStore.*selectedEntityKey"
---

<objective>
Integrate all components into unified browse/draft page with routing.

Purpose: Implement FE-06 (same UI serves browse and draft modes), complete the main browse experience.
Output: Working /browse route with split panels, graph visualization, entity detail, and draft mode support.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/intel/summary.md
@.planning/phases/12-frontend-graph-visualization/12-CONTEXT.md
@.planning/phases/12-frontend-graph-visualization/12-RESEARCH.md
@frontend/src/App.tsx
@frontend/src/components/layout/MainLayout.tsx
@frontend/src/components/layout/SplitLayout.tsx
@frontend/src/components/layout/SidebarV2.tsx
@frontend/src/components/graph/GraphCanvas.tsx
@frontend/src/components/draft/DraftBanner.tsx
@frontend/src/stores/graphStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EntityDetailPanel component</name>
  <files>frontend/src/components/entity/EntityDetailPanel.tsx</files>
  <action>
Create a detail panel component that shows the selected entity's information.

This goes in the bottom panel of the split layout. It displays details for whatever entity is selected in graphStore.

Props:
- entityKey: string | null
- entityType: string (default 'category')
- draftId?: string

Implementation:
1. If no entityKey, show empty state: "Select an entity to view details"
2. Based on entityType, fetch and display appropriate data:
   - category: useCategory(entityKey, draftId) - show parents, properties
   - property: useProperty(entityKey, draftId) - show datatype, used-by
   - For now, focus on category as primary entity type
3. Display:
   - Entity label as heading
   - Description if present
   - Change status badge if in draft mode
   - For categories: parent categories list, properties list with inheritance info
4. Loading and error states

This is a simplified detail view for the browse page. Full detail pages with edit mode are Phase 13.

Keep it simple:
- Card layout
- Section headings for Parents, Properties
- Links to related entities (clicking navigates graph)
  </action>
  <verify>Panel shows category details when entity selected; shows empty state otherwise</verify>
  <done>EntityDetailPanel displays selected entity information</done>
</task>

<task type="auto">
  <name>Task 2: Create MainLayoutV2 and BrowsePage</name>
  <files>frontend/src/components/layout/MainLayoutV2.tsx, frontend/src/pages/BrowsePage.tsx</files>
  <action>
Create the v2 layout wrapper and main browse page.

MainLayoutV2.tsx:
- Structure similar to MainLayout but with v2 components
- Flex layout: SidebarV2 on left, content area on right
- DraftBanner at top of content area (conditional on draft_id)
- DraftSelector in header area
- Outlet for page content

Layout:
```
+------------------------------------------+
| [Ontology Hub]      [DraftSelector]      |
+----------+-------------------------------+
|          |  [DraftBanner if draft_id]    |
| Sidebar  |  +-------------------------+  |
|   V2     |  |     GraphCanvas         |  |
|          |  |-------------------------|  |
|          |  |    EntityDetailPanel    |  |
|          |  +-------------------------+  |
+----------+-------------------------------+
```

Read draft_id from useSearchParams.
If draft_id present, fetch draft info and show DraftBanner.

BrowsePage.tsx:
- Get selectedEntityKey from graphStore
- Get draft_id from URL (useSearchParams)
- Render SplitLayout with:
  - Top panel: GraphCanvas with selectedEntityKey and draft_id
  - Bottom panel: EntityDetailPanel with selectedEntityKey and draft_id
- Handle URL sync: if URL has ?entity=X, set graphStore.selectedEntityKey
- Handle selection sync: when graphStore.selectedEntityKey changes, update URL ?entity param

URL structure for browse page:
- /browse - canonical browse, no entity selected
- /browse?entity=Person - canonical browse with Person selected
- /browse?draft_id=abc123 - draft mode
- /browse?draft_id=abc123&entity=Person - draft mode with entity selected
  </action>
  <verify>BrowsePage renders with graph and detail panels; draft_id activates draft mode</verify>
  <done>MainLayoutV2 and BrowsePage integrate all v2 components</done>
</task>

<task type="auto">
  <name>Task 3: Update App.tsx with new routes</name>
  <files>frontend/src/App.tsx</files>
  <action>
Add the new /browse route and update routing structure.

Changes to App.tsx:
1. Import MainLayoutV2 and BrowsePage
2. Add /browse route using MainLayoutV2:

```typescript
{
  path: '/browse',
  element: <MainLayoutV2 />,
  children: [
    {
      index: true,
      element: <BrowsePage />,
    },
  ],
}
```

3. Keep existing routes (HomePage, DraftPage, etc.) for backward compatibility
4. Consider making /browse the new home eventually (but don't change / for now)

The existing v1 routes remain functional. v2 browse experience is at /browse.

Future consideration: may redirect / to /browse in Phase 14 when v2 is complete.
  </action>
  <verify>/browse route renders BrowsePage with v2 layout</verify>
  <done>App.tsx includes /browse route with MainLayoutV2</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes
2. Navigate to /browse - see sidebar, graph, and detail panel
3. Click entity in sidebar - updates graph selection and detail panel
4. Click node in graph - updates sidebar highlight and detail panel
5. Add ?draft_id=xxx - draft banner appears, entities show change_status
6. Graph and detail both use same draft context
7. Panel resize persists across page refresh
</verification>

<success_criteria>
- BrowsePage renders split layout with graph and detail panels
- Same UI serves both canonical browse and draft mode (FE-06)
- URL ?draft_id parameter activates draft context throughout
- Entity selection syncs between sidebar, graph, and detail panel
- /browse route accessible and functional
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-graph-visualization/12-06-SUMMARY.md`
</output>

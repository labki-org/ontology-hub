---
phase: 12-frontend-graph-visualization
plan: 03
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - frontend/src/components/layout/SidebarV2.tsx
  - frontend/src/components/search/EntitySearch.tsx
  - frontend/src/components/draft/DraftBanner.tsx
  - frontend/src/components/draft/DraftSelector.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar shows all 6 entity types in grouped sections"
    - "Search filters entities in real-time as user types"
    - "Draft mode shows change badges on modified entities"
    - "Draft banner displays when draft_id is active"
  artifacts:
    - path: "frontend/src/components/layout/SidebarV2.tsx"
      provides: "v2 sidebar with entity type sections"
      min_lines: 100
    - path: "frontend/src/components/search/EntitySearch.tsx"
      provides: "Live search across all entity types"
      min_lines: 30
    - path: "frontend/src/components/draft/DraftBanner.tsx"
      provides: "Draft mode banner with status"
      min_lines: 20
  key_links:
    - from: "frontend/src/components/layout/SidebarV2.tsx"
      to: "useCategories"
      via: "import from entitiesV2"
      pattern: "useCategories|useProperties|useModules"
---

<objective>
Build the v2 sidebar with all entity types, live search, draft mode badges, and draft banner.

Purpose: Implement FE-01 (sidebar sections), FE-02 (search), FE-03 (change badges), FE-04 (version display), FE-05 (draft selector).
Output: Complete sidebar navigation with draft-aware entity lists and draft mode banner.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/intel/summary.md
@.planning/phases/12-frontend-graph-visualization/12-CONTEXT.md
@.planning/phases/12-frontend-graph-visualization/12-RESEARCH.md
@frontend/src/components/layout/Sidebar.tsx
@frontend/src/api/entitiesV2.ts
@frontend/src/stores/draftStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EntitySearch component</name>
  <files>frontend/src/components/search/EntitySearch.tsx</files>
  <action>
Create a live search component that filters entities as user types.

Based on CONTEXT.md:
- Single search input at top of sidebar
- Live filtering as user types, showing matches across all sections
- No need to press enter

Implementation:
1. Input with search icon (lucide Search)
2. Local state for search term
3. useDebounce hook (already exists at @/hooks/useDebounce) with 150ms delay
4. Export both the component and a useSearchFilter hook

The useSearchFilter hook:
- Takes search term and entity list
- Returns filtered list where label contains search term (case-insensitive)
- If search term is empty, returns original list

Component props:
- value: string
- onChange: (value: string) => void
- placeholder?: string (default "Search entities...")

Style with existing shadcn patterns: rounded input, muted placeholder, focus ring.
  </action>
  <verify>Type in search, verify filtering happens after debounce</verify>
  <done>EntitySearch component with live filtering via debounced input</done>
</task>

<task type="auto">
  <name>Task 2: Create SidebarV2 with all entity types</name>
  <files>frontend/src/components/layout/SidebarV2.tsx</files>
  <action>
Create a new sidebar component for the v2 browse/draft interface.

Based on CONTEXT.md structure:
- Grouped hierarchy: Schema (category/property/subobject) + Modules (module/bundle) + Templates
- All sections expanded by default
- Clicking an entity sets it as selected (updates graphStore)

Use the v2 API hooks from entitiesV2.ts:
- useCategories, useProperties, useSubobjects
- useModules, useBundles, useTemplates

Get draft context from URL (useSearchParams for draft_id).

Structure:
1. Header with "Ontology Hub" link to /
2. EntitySearch component for filtering
3. Collapsible sections using existing Collapsible components:
   - "Schema" group:
     - Categories (icon: Boxes)
     - Properties (icon: Tag)
     - Subobjects (icon: Package)
   - "Modules" group:
     - Modules (icon: Layers)
     - Bundles (icon: Archive)
   - "Templates" section (icon: FileCode)

For each entity in a section:
- Show label as link
- If in draft mode AND entity has change_status, show badge:
  - added: green badge "+"
  - modified: yellow badge "~"
  - deleted: red badge with strikethrough on label
- On click: update graphStore.setSelectedEntity(entity_key)

Use existing Badge component from shadcn/ui for change indicators.
Add entity count Badge next to section header.

Import useGraphStore to set selected entity on click.
Import useSearchParams to get draft_id for API calls.
  </action>
  <verify>Sidebar renders all 6 entity types, search filters work, clicking sets selection</verify>
  <done>SidebarV2 shows all entity types with collapsible sections and change badges</done>
</task>

<task type="auto">
  <name>Task 3: Create DraftBanner and DraftSelector</name>
  <files>frontend/src/components/draft/DraftBanner.tsx, frontend/src/components/draft/DraftSelector.tsx</files>
  <action>
Create draft mode UI components for header area.

DraftBanner (persistent top banner when in draft mode):
Based on CONTEXT.md: "Persistent top banner when in draft mode showing draft name, status, and action buttons"

Props:
- draft: DraftResponse (from v2 types)
- onValidate?: () => void
- onSubmit?: () => void
- onExit: () => void

Display:
- Yellow/amber background (bg-amber-50 or similar)
- Left: "Draft: {title}" with status badge (DRAFT/VALIDATED/etc)
- Right: Validate button, Submit PR button (disabled until VALIDATED), Exit button
- Submit button disabled unless status === 'VALIDATED'

DraftSelector (dropdown to enter/switch drafts):
Based on CONTEXT.md: "URL-based and selector-based entry"

This is a dropdown in the header that:
- Shows "Browse canonical" when no draft selected
- Shows draft title when draft is active
- Allows entering a draft token via input
- "Exit draft mode" option

Implementation:
- Use a simple dropdown/popover pattern
- Input field to enter draft token
- "Enter Draft" button
- When clicked, navigate to ?draft_id={token}

For now, DraftSelector just handles manual token entry. Future: could list recent drafts.

Export both components.
  </action>
  <verify>DraftBanner shows when draft active; DraftSelector allows entering draft mode via token</verify>
  <done>DraftBanner displays draft status; DraftSelector allows draft mode entry</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes
2. SidebarV2 renders all 6 entity types with counts
3. Search filters entity lists in real-time
4. Change badges appear on entities when in draft mode
5. DraftBanner displays draft info when draft_id in URL
</verification>

<success_criteria>
- Sidebar shows Categories, Properties, Subobjects, Modules, Bundles, Templates
- Search filters all sections as user types
- Change badges (added/modified/deleted) appear in draft mode
- DraftBanner shows draft name, status, and action buttons
- DraftSelector allows entering draft mode via token
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-graph-visualization/12-03-SUMMARY.md`
</output>

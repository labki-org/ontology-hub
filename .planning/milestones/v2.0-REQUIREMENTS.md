# Requirements Archive: v2.0 Platform Rebuild

**Archived:** 2026-01-25
**Status:** SHIPPED

This is the archived requirements specification for v2.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Ontology Hub v2.0

**Defined:** 2026-01-23
**Core Value:** Enable wiki admins to go from local schema edit to GitHub PR in under 5 minutes, with zero platform accounts and strong validation feedback.

## v2.0 Requirements

Requirements for the platform rebuild. Each maps to roadmap phases.

### Database Foundation

- [x] **DB-01**: ontology_version table tracks current canonical state (commit_sha, ingest_status, ingested_at) — only latest version retained
- [x] **DB-02**: Entity tables (category, property, subobject, module, bundle, template) store canonical JSON with entity_key and source_path
- [x] **DB-03**: category_parent table stores parent relationships (no version scoping — only latest exists)
- [x] **DB-04**: category_property table stores property membership with required flag and origin (direct/inherited)
- [x] **DB-05**: category_property_effective materialized view precomputes inherited properties with source + depth provenance
- [x] **DB-06**: module_entity table stores module membership for all entity types
- [x] **DB-07**: bundle_module table stores bundle-to-module relationships
- [x] **DB-08**: draft table stores base_commit_sha (for auto-rebase), status, title, source (hub_ui/mediawiki_push)
- [x] **DB-09**: draft_change table stores change_type, entity_type, entity_key, patch (JSON Patch), replacement_json

### Ingest Pipeline

- [x] **ING-01**: Webhook endpoint receives push notification and triggers ingest
- [x] **ING-02**: Pull latest commit from labki-schemas repo
- [x] **ING-03**: Validate all JSON files against _schema.json files from repo
- [x] **ING-04**: Parse and populate canonical entity tables (replacing previous data)
- [x] **ING-05**: Compute and populate relationship tables (category_parent, category_property, module_entity, bundle_module)
- [x] **ING-06**: Refresh category_property_effective materialized view
- [x] **ING-07**: Store ingest warnings/errors in ontology_version record

### Query Layer

- [x] **QRY-01**: Entity queries accept ontology_version_id for canonical reads
- [x] **QRY-02**: Entity queries accept draft_id and return effective view (canonical + draft overlay)
- [x] **QRY-03**: API computes effective view server-side; frontend never merges
- [x] **QRY-04**: Category detail returns parents, direct properties, inherited properties with provenance
- [x] **QRY-05**: Property detail returns categories using it (where-used)
- [x] **QRY-06**: Module detail returns direct entities and computed closure (auto-included dependencies)
- [x] **QRY-07**: Bundle detail returns modules and computed closure

### Graph Endpoints

- [x] **GRP-01**: Neighborhood graph endpoint returns nodes/edges within depth of selected entity
- [x] **GRP-02**: Module-scoped graph endpoint returns nodes/edges for specified module
- [x] **GRP-03**: Graph endpoints return module membership for hull rendering
- [x] **GRP-04**: Graph nodes include change status badges (added/modified/deleted) in draft context

### Draft System

- [x] **DRF-01**: Draft creation binds to base_commit_sha for tracking
- [x] **DRF-02**: Draft changes stored as JSON Patch for updates, full replacement for creates
- [x] **DRF-03**: Effective view computation overlays draft changes on canonical data
- [x] **DRF-04**: Localized re-materialization of inheritance during draft edits
- [x] **DRF-05**: Draft status lifecycle (draft, validated, submitted, merged, rejected)
- [x] **DRF-06**: MediaWiki push import creates draft_change rows from payload
- [x] **DRF-07**: Auto-rebase: when new canonical is ingested, in-progress drafts rebase automatically

### Validation Engine

- [x] **VAL-01**: JSON Schema validation against _schema.json files from canonical repo
- [x] **VAL-02**: Reference resolution checks (all parents, properties, modules exist)
- [x] **VAL-03**: Circular inheritance detection with cycle path reporting
- [x] **VAL-04**: Breaking change detection (deletions affecting other entities)
- [x] **VAL-05**: Module/bundle version increment suggestions (semver)
- [x] **VAL-06**: Validation returns structured messages with entity_key, field_path, severity, code

### Frontend Browsing

- [x] **FE-01**: Left sidebar with collapsible sections for each entity type
- [x] **FE-02**: Search box filters entities across all types
- [x] **FE-03**: Entity lists show change badges in draft mode (added/modified/deleted)
- [x] **FE-04**: Current ontology version display (commit SHA, module/bundle versions)
- [x] **FE-05**: Draft selector shows current draft with status
- [x] **FE-06**: Same UI components serve both browse and draft modes

### Graph Visualization

- [x] **GV-01**: Graph panel on category page centered on selected category
- [x] **GV-02**: Depth control (1-3 levels)
- [x] **GV-03**: Edge type filter (inheritance, properties, subobjects)
- [x] **GV-04**: Module hull overlays using d3-polygon convex hulls
- [x] **GV-05**: Multi-hull display (multiple modules visible simultaneously)
- [x] **GV-06**: Module selection panel to toggle hull visibility
- [x] **GV-07**: Click-to-focus and pan/zoom navigation

### Category Detail

- [x] **CAT-01**: Header with name, label, description
- [x] **CAT-02**: Parents list with add/remove in edit mode
- [x] **CAT-03**: Direct properties section
- [x] **CAT-04**: Inherited properties section grouped by parent with provenance
- [x] **CAT-05**: Module/bundle membership display
- [x] **CAT-06**: Edit icons appear in draft mode for adding/removing properties

### Property Detail

- [x] **PRP-01**: Header with name, label, description, datatype, cardinality
- [x] **PRP-02**: Where-used list showing categories using this property
- [x] **PRP-03**: Module/bundle membership display
- [x] **PRP-04**: Edit icons for modifying property attributes in draft mode

### Subobject Detail

- [x] **SUB-01**: Header with name, label, description
- [x] **SUB-02**: Required/optional properties lists
- [x] **SUB-03**: Where-used list showing categories/properties using this subobject
- [x] **SUB-04**: Edit icons in draft mode

### Module Detail

- [x] **MOD-01**: Header with name, label, description
- [x] **MOD-02**: Direct members list (categories, properties, subobjects, templates)
- [x] **MOD-03**: Computed closure view showing auto-included dependencies
- [x] **MOD-04**: Dependencies list (other modules this one depends on)
- [x] **MOD-05**: Edit icons for adding/removing members in draft mode
- [x] **MOD-06**: Suggested version increment display

### Bundle Detail

- [x] **BND-01**: Header with name, label, description
- [x] **BND-02**: Modules list
- [x] **BND-03**: Computed closure view (all entities via modules)
- [x] **BND-04**: Edit icons for adding/removing modules in draft mode
- [x] **BND-05**: Suggested version increment display

### Template Detail

- [x] **TPL-01**: Header with name, label, description
- [x] **TPL-02**: Wikitext content display (read-only view)
- [x] **TPL-03**: Wikitext editor in draft mode (simple text area)
- [x] **TPL-04**: Module membership display

### Draft Workflow UI

- [x] **DWF-01**: Draft banner shows title, status, validate button, submit PR button
- [x] **DWF-02**: Validate button triggers validation and shows inline results
- [x] **DWF-03**: Change highlighting with green/amber/red badges
- [x] **DWF-04**: Diff view showing per-entity changes grouped by type
- [x] **DWF-05**: Submit PR disabled until validation passes (no errors)

### PR Submission

- [x] **PR-01**: GitHub OAuth flow at PR submission time (existing v1.0 pattern)
- [x] **PR-02**: Generate file changes from effective JSON
- [x] **PR-03**: Create branch and commit with all draft changes
- [x] **PR-04**: Open PR with structured summary (categorized changes, validation results)
- [x] **PR-05**: Include suggested semver increments for modules/bundles in PR body

## Traceability

| Requirement Group | Count | Phase | Status |
|-------------------|-------|-------|--------|
| DB-01 to DB-09 | 9 | Phase 8 | All complete |
| ING-01 to ING-07 | 7 | Phase 9 | All complete |
| QRY-01 to QRY-07 | 7 | Phase 10 | All complete |
| GRP-01 to GRP-04 | 4 | Phase 10 | All complete |
| DRF-01 to DRF-07 | 7 | Phase 11 | All complete |
| VAL-01 to VAL-06 | 6 | Phase 14 | All complete |
| FE-01 to FE-06 | 6 | Phase 12 | All complete |
| GV-01 to GV-07 | 7 | Phase 12 | All complete |
| CAT-01 to CAT-06 | 6 | Phase 13 | All complete |
| PRP-01 to PRP-04 | 4 | Phase 13 | All complete |
| SUB-01 to SUB-04 | 4 | Phase 13 | All complete |
| MOD-01 to MOD-06 | 6 | Phase 13 | All complete |
| BND-01 to BND-05 | 5 | Phase 13 | All complete |
| TPL-01 to TPL-04 | 4 | Phase 13 | All complete |
| DWF-01 to DWF-05 | 5 | Phase 14 | All complete |
| PR-01 to PR-05 | 5 | Phase 14 | All complete |

**Coverage:**
- v2.0 requirements: 92 total
- Mapped to phases: 92
- Complete: 92 (100%)

---

## Milestone Summary

**Shipped:** 92 of 92 v2.0 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-01-25 as part of v2.0 milestone completion*

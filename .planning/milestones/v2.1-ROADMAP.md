# Milestone v2.1: Bug Fixes & UX Improvements

**Status:** SHIPPED 2026-01-25
**Phases:** 16-22
**Total Plans:** 24

## Overview

Fix entity detail loading bugs, restore draft workflow functionality, and improve editing UX with inline controls and change propagation visibility. This milestone addressed all bugs discovered during v2.0 testing and added significant UX improvements for draft editing.

## Phases

### Phase 16: Core Bug Fixes

**Goal:** Users can reliably view all entity types and use draft workflow actions.
**Depends on:** None (first phase of milestone)
**Plans:** 2 plans

Plans:
- [x] 16-01: Add missing backend endpoints for subobject/template detail
- [x] 16-02: Wire auto-validation clearing and verify draft workflow

**Details:**
Added GET /api/v2/subobjects/{entity_key} and GET /api/v2/templates/{entity_key} endpoints following existing PropertyDetailResponse pattern. Wired auto-validation clearing to useAutoSave hook.

---

### Phase 17: Graph View Fixes

**Goal:** Graph visualization renders all entity types with smooth visual boundaries.
**Depends on:** Phase 16
**Plans:** 3 plans

Plans:
- [x] 17-01: Extend graph query API to return property/subobject/template nodes
- [x] 17-02: Add SVG shape differentiation and hover highlighting to GraphNode
- [x] 17-03: Implement smooth Catmull-Rom hull curves with module labels

**Details:**
Extended graph API to return all entity types. Added d3-shape for SVG path generation (diamond for properties, hexagon for subobjects, circle for templates). Implemented Catmull-Rom interpolation (alpha=0.5) for smooth hull curves with module name labels.

---

### Phase 18: Inline Editing UX

**Goal:** Users can edit entities in-place with intuitive hover controls.
**Depends on:** Phase 16
**Plans:** 3 plans

Plans:
- [x] 18-01: Create InlineEditField and DeletedItemBadge components
- [x] 18-02: Integrate hover-reveal editing into detail modals
- [x] 18-03: Add editing to EntityDetailPanel (expanded sidebar view)

**Details:**
Created InlineEditField component with group-hover pattern for edit/delete icons. Added DeletedItemBadge for soft-delete visualization. Set up vitest with jsdom for React component testing.

---

### Phase 19: Change Propagation

**Goal:** Users can see the impact of their changes across the dependency graph.
**Depends on:** Phase 18
**Plans:** 4 plans

Plans:
- [x] 19-01: Extend draftStoreV2 with change tracking and create dependency graph utility
- [x] 19-02: Add sidebar highlighting and affected entity count badge
- [x] 19-03: Add graph node and edge change propagation visualization
- [x] 19-04: Add inheritance chain section to CategoryDetail

**Details:**
Added directlyEditedEntities and transitivelyAffectedEntities Sets to draftStoreV2. Created BFS-based computeAffectedEntities utility. Integrated two-tier highlighting (blue-100 for direct, blue-50 for transitive) in sidebar, graph, and detail modal.

---

### Phase 20: Entity Management

**Goal:** Users can create and delete entities within drafts.
**Depends on:** Phase 16, Phase 18
**Plans:** 9 plans

Plans:
- [x] 20-01: Create form infrastructure (FormField, Zod schemas, API mutation)
- [x] 20-02: Create simple entity forms (Category, Property, Subobject)
- [x] 20-03: Create complex entity forms (Template, Module, Bundle)
- [x] 20-04: Integrate "+ New" buttons into sidebar with create modal
- [x] 20-05: Create EntityCombobox for relationship management
- [x] 20-06: Implement entity deletion with dependency checking
- [x] 20-07: Implement cascading create flow for nested entities
- [x] 20-08: Integrate relationship editing into entity detail views
- [x] 20-09: Human verification of complete entity management flow

**Details:**
Built React Hook Form infrastructure with FormField wrapper and Zod schemas for all 6 entity types. Added cmdk Command primitive for type-ahead entity search. Implemented cascading create flow with NestedModalStack. Human verification discovered 3 bugs (fixed in Phases 21-22).

---

### Phase 21: Critical Bug Fixes (Gap Closure)

**Goal:** Restore core draft workflow - users can validate and submit PRs.
**Depends on:** Phase 20
**Plans:** 1 plan
**Gap Closure:** Closes BUG-003 from v2.1 audit

Plans:
- [x] 21-01: Debug and fix Validate/Submit PR button disabled state

**Details:**
Fixed status case mismatch (DRAFT vs draft), GitHubClient instantiation, ingest pipeline versioned file filtering, semver service entity_key/entity_id mismatch, draft query cache invalidation, draft-created entity editing, OAuth redirect URL, and added auto-generated PR titles.

---

### Phase 22: Entity Lifecycle Bug Fixes (Gap Closure)

**Goal:** Complete entity lifecycle - new entities appear in graph and can be deleted.
**Depends on:** Phase 21
**Plans:** 2 plans
**Gap Closure:** Closes BUG-001, BUG-002 from v2.1 audit

Plans:
- [x] 22-01: Fix graph query invalidation after entity creation
- [x] 22-02: Fix delete functionality for newly created entities

**Details:**
Added broad ['graph'] cache invalidation to useCreateEntityChange.onSuccess. Added early return with single-node graph for isolated draft entities. Implemented CREATE->DELETE special case that removes CREATE record entirely instead of creating DELETE change.

---

## Milestone Summary

**Decimal Phases:** None (no urgent insertions required)

**Key Decisions:**
- SVG path generators for graph nodes (d3-shape for diamond, hexagon, circle)
- Store-based hover state for node dimming/highlighting
- Catmull-Rom alpha=0.5 for smooth hull curves
- BFS traversal for reverse dependency computation
- cmdk Command primitive with Radix Popover for autocomplete
- CREATE->DELETE removes CREATE record entirely
- Direct backend URL for OAuth to match GitHub app callback config

**Issues Resolved:**
- BUG-001: Graph doesn't update on entity creation (Fixed: cache invalidation)
- BUG-002: Cannot delete newly created entities (Fixed: CREATE->DELETE handling)
- BUG-003: Validate/Submit PR buttons always disabled (Fixed: status normalization)

**Issues Deferred:**
- Performance optimization for large ontologies (deferred to v2.2+)
- E2E test suite for critical flows (deferred to v2.2+)

**Technical Debt Incurred:**
- CategoryDetail.tsx:354 - console.log for property removal
- CategoryDetail.tsx:353,358 - TODO comments for property removal and module membership
- Missing 21-VERIFICATION.md (summary exists, human-verified)

---

*For current project status, see .planning/ROADMAP.md*
